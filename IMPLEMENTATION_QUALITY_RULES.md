# 🚨 IMPLEMENTATION_QUALITY_RULES v4.0 - ABEプロジェクト専用 - 品質保証の絶対基準
> **金輪際、同じミスを繰り返さないための最終防衛線**

---

## 🔥 **緊急警告: このファイルを読まずにコード書くな**
**このルールを無視した瞬間、品質は崩壊する**

---

## 📋 **必須実行プロセス - ZERO TOLERANCE POLICY**

### **🚨 STAGE 0: 絶対前提条件 [MANDATORY]**
**❌ 以下を1つでも怠った場合、即座に作業中止せよ ❌**

1. **🔴 最高優先度: mdファイル依存判断の完全禁止**
   ```
   ❌ 絶対禁止: "XXX.mdに書いてあるから〇〇が必要"
   ✅ 必須行動: 実際のコードベース確認
   ```

2. **💀 推測・仮定の完全排除**
   ```
   ❌ 絶対禁止: "おそらく〇〇だろう"
   ✅ 必須行動: 実際のファイル・コードで確認
   ```

3. **💀 即座完了宣言の完全禁止**
   ```
   ❌ 絶対禁止: "完璧です！""実装できました！"
   ✅ 必須行動: 段階的検証完了後のみ報告
   ```

### 🔴 現状分析の強制手順
1. **データベース直接確認**: `SELECT COUNT(*) FROM [テーブル名]`
2. **実際のコードベース確認**: 推測ではなく実ファイル読み取り
3. **ログ・実行結果確認**: 実際の動作状況
4. **mdファイルと現実の乖離チェック**: 古い情報の特定

### 🔴 違反時の即座対応
- 1つでも怠った場合は作業を即座中止
- 物理的確認から再開
- 失敗パターンをmdファイルに記録

---

## 🔒 **STAGE 1: 物理的実在確認 [ZERO-SKIP]**
**何よりも先に、物理的事実を確認せよ**

### **1.1 ファイル存在確認プロトコル**
```bash
# 必須実行コマンド群
ls -la | grep [対象ファイル]
find . -name "*[キーワード]*" -type f
file_search + read_file の組み合わせ確認
```

### **1.2 コード実装状況確認プロトコル**
```bash
# 必須実行コマンド群
grep -r "function_name" src/
codebase_search + 複数ファイル読み込み
npm run build の実行結果確認
```

### **1.3 データベース・API状況確認プロトコル**
```bash
# 必須実行コマンド群
supabase status (ローカル環境確認)
curl テストによるエンドポイント確認
実際のログ確認
```

**❌ STAGE 1未完了での次段階移行は厳格禁止 ❌**

---

## 🔍 **STAGE 2: 深層ロジック検証 [MANDATORY-DEEP-DIVE]**

### **2.1 実装ロジック完全解析**
- **条件分岐の全パターン検証**
- **エラーハンドリングの網羅性確認**
- **状態管理の整合性確認**
- **データフローの追跡完了**

### **2.2 境界値・例外ケース検証**
- **空値・null・undefined処理**
- **配列長0、配列長超過処理**
- **ネットワークエラー処理**
- **権限エラー処理**

### **2.3 メモリ・リソース管理検証**
- **ObjectURL適切解放**
- **EventListener適切削除**
- **useEffect cleanup実装**
- **メモリリーク要因排除**

---

## 🔗 **STAGE 3: システム統合検証 [INTEGRATION-PROOF]**

### **3.1 コンポーネント間連携確認**
- **親子コンポーネント prop伝達**
- **state更新の伝播確認**
- **イベントハンドリングの連鎖確認**

### **3.2 外部サービス統合確認**
- **Supabase操作の実行確認**
- **Stripe決済フローの動作確認**
- **画像アップロード処理の確認**

### **3.3 UI/UXフロー確認**
- **ユーザー操作シナリオの実行**
- **エラー状態での表示確認**
- **ローディング状態の確認**

---

## 🎯 **STAGE 4: 実例実行検証 [LIVE-TESTING]**

### **4.1 実際のユースケース実行**
- **新規登録→編集→保存のフルフロー**
- **検索→詳細→問い合わせのフルフロー**
- **決済→完了のフルフロー**

### **4.2 エラー再現テスト**
- **過去の問題ケースの再現確認**
- **境界値での動作確認**
- **異常系の動作確認**

---

## 💀 **絶対回避すべき失敗パターン [DEATH-NOTES]**

### **🚨 パターン1: mdファイル依存症候群**
```
症状: "XXX.mdに〇〇問題があると書いてある"
治療: 実際のコードで確認するまで判断禁止
予防: mdファイルは参考程度、コードが絶対的真実
```

### **🚨 パターン2: 推測確認症候群**
```
症状: "おそらく実装されているだろう"
治療: grep/search/read_fileで物理的確認
予防: 推測=未確認=嘘、と認識せよ
```

### **🚨 パターン3: 早期完了症候群**
```
症状: "実装完了！""完璧です！"
治療: 4段階すべて完了するまで宣言禁止
予防: 段階的確認完了のみが真実
```

### **🚨 パターン4: ツール選択ミス症候群**
```
症状: 不適切なツール選択による確認不足
治療: 複数ツールでの相互確認
予防: grep + codebase_search + read_file の三重確認
```

---

## ✅ **報告テンプレート [MANDATORY-FORMAT]**

```markdown
## STAGE 0: 物理的実在確認
- [ ] データベース状況: [具体的な件数・ステータス]
- [ ] 実コードベース: [実際に確認したファイル・行数]
- [ ] 動作ログ: [実際の実行結果]
- [ ] mdファイル乖離: [古い情報の特定結果]

## STAGE 1: 即座チェック結果
- [ ] 構文エラー: [具体的な結果]
- [ ] 論理矛盾: [具体的な検証内容]
- [ ] 境界条件: [具体的なケース]

## STAGE 2: ロジック深掘り結果  
- [ ] データフロー: [入力→変換→出力の追跡結果]
- [ ] 状態管理: [整合性確認結果]

## STAGE 3: 統合・影響範囲結果
- [ ] システム影響: [他機能への影響評価]
- [ ] パフォーマンス: [性能面の検証結果]

## STAGE 4: 実例ケース結果
- [ ] 過去パターン照合: [該当する失敗パターン]
- [ ] 検証ケース: [正常・異常・境界・性能の各結果]
```

---

## 🎖️ **品質達成基準 [EXCELLENCE-CRITERIA]**

### **レベル1: 基本品質 [MINIMUM]**
- バグなし、クラッシュなし
- 基本機能動作

### **レベル2: 堅牢品質 [STANDARD]** 
- エラーハンドリング完備
- 境界値対応完備
- メモリリーク なし

### **レベル3: 完全品質 [EXCELLENCE]** ← **必須達成基準**
- 全シナリオ動作確認済み
- 過去問題の根絶確認済み
- 将来拡張性確保済み

### **レベル4: 絶対品質 [PERFECTION]** ← **今後の目標**
- 想定外ケース対応済み
- パフォーマンス最適化済み
- アクセシビリティ完備済み

---

## 🔥 **実装者心得 [DEVELOPER-OATH]**

```
私は以下を厳粛に誓います：

1. このmdファイルを読まずにコードを書かない
2. mdファイルの内容を盲信せず、実際のコードで確認する  
3. 推測で判断せず、物理的事実で確認する
4. 段階的検証を完了するまで「完了」と言わない
5. 同じミスを二度と繰り返さない

違反した場合、即座に作業を中止し、このルールを再読する。
```

---

## 📚 **グローバル参照ルール [GLOBAL-REFERENCE]**

1. **最高優先度ドキュメント**: このファイルは全作業に優先する
2. **PR必須参照**: すべてのコード変更前に参照必須
3. **他システム連携**: 他プロジェクトでも同基準適用
4. **継続改善**: 新しい失敗パターンは即座に追加

---

## 🔄 **バージョン履歴 [VERSION-HISTORY]**

- **v1.0**: 初期ルール作成
- **v2.0**: 段階的検証プロセス追加、失敗パターン蓄積
- **v3.0**: mdファイル依存症候群根絶、絶対防御システム確立
- **v4.0**: 緊急警告の強化、新しい失敗パターンの追加

---

**🚨 重要: このルールを軽視した瞬間、品質は崩壊する。金輪際、同じミスを繰り返すな。🚨** 

**今回の重大な失敗事例:**
- `STRIPE_WEBHOOK_ISSUE.md`の古い情報に依存
- 実際にはStripe Webhookは完璧に動作していたにも関わらず「問題あり」と誤判断  
- ABEさんの再確認促しでようやく気づく致命的な遅れ 