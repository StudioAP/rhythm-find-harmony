# Supabaseèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼šç¢ºèªãƒ¡ãƒ¼ãƒ«æœªé…ä¿¡å•é¡Œã®è©³ç´°èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“‹ å•é¡Œæ¦‚è¦

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: Piano Search App (React + Vite + TypeScript + Supabase)  
**ç’°å¢ƒ**: æœ¬ç•ªç’°å¢ƒ (Cloudflare Pages) + Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ  
**å•é¡Œ**: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒå®Ÿéš›ã«é€ä¿¡ã•ã‚Œãªã„

**ç¾çŠ¶**: Supabase Auth API ã¯ 200 OK ã‚’è¿”ã—ã€æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ä½œæˆã•ã‚Œã‚‹ãŒã€**å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„**

---

## ğŸ”§ å®Ÿæ–½æ¸ˆã¿è¨­å®šãƒ»ä¿®æ­£

### 1. âœ… Supabase SMTPè¨­å®šå®Œäº†
**Authentication â†’ Settings â†’ Email**

| é …ç›® | è¨­å®šå€¤ |
|------|--------|
| **Email service provider** | Custom SMTP |
| **Host** | `smtp.resend.com` |
| **Port** | `587` |
| **Username** | `resend` |
| **Password** | `re_Kxxxxxxxxxï¼ˆResend API Keyï¼‰` |
| **Sender name** | `Piano Search` |
| **Sender email** | `no-reply@pianosearch.com` |

### 2. âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/pages/Auth.tsx`

- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œçŸ¥ãƒ­ã‚¸ãƒƒã‚¯ã®è¿½åŠ 
- è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…
- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®è¿½åŠ 

---

## ğŸ§ª æœ€æ–°ãƒ†ã‚¹ãƒˆçµæœï¼ˆ2025-06-01 13:21ï¼‰

### **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1**: `test-auth-email@example.com`
```javascript
// çµæœ: å¤±æ•—ï¼ˆ500ã‚¨ãƒ©ãƒ¼ï¼‰
AuthApiError: Error sending confirmation email
HTTP Status: 500
data.user: null
data.session: null
```

**åŸå› **: Resendã®åˆ¶é™ã«ã‚ˆã‚Š `example.com` ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ä½¿ç”¨ä¸å¯

### **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2**: `abe-a@tachibana-u.ac.jp`
```javascript
// çµæœ: APIæˆåŠŸã€ä½†ã—ãƒ¡ãƒ¼ãƒ«æœªé…ä¿¡
Supabase signUp response: {data: {â€¦}, error: null}
data.session: null
data.user: {
  id: '2e81b228-5fa6-460f-a0e6-d33485c79aba',
  email: 'abe-a@tachibana-u.ac.jp',
  created_at: '2025-06-01T13:21:33.012347546Z',
  email_confirmed_at: undefined,  // â† æœªç¢ºèªçŠ¶æ…‹
  updated_at: '2025-06-01T13:21:33.012347546Z',
  last_sign_in_at: undefined
}
```

**å•é¡Œ**: 
- âœ… API ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 200 OK
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ: æˆåŠŸ
- âŒ **å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é…ä¿¡: å¤±æ•—ï¼ˆå—ä¿¡ãƒœãƒƒã‚¯ã‚¹ã§æœªç¢ºèªï¼‰**

---

## ğŸ“Š Supabaseãƒ­ã‚°åˆ†æ

### Auth Service ãƒ­ã‚°ï¼ˆæœ€æ–°ï¼‰
```
2025-06-01 13:16:25.528+00:00
[ERROR] Error sending confirmation email: Invalid `to` field. 
Please use our testing email address instead of domains like `example.com`
```

**åˆ†æ**: 
- `example.com` ãƒ†ã‚¹ãƒˆã§ã®ã‚¨ãƒ©ãƒ¼ã¯è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹
- `abe-a@tachibana-u.ac.jp` ãƒ†ã‚¹ãƒˆã®ãƒ­ã‚°ã¯æœªè¡¨ç¤ºï¼ˆæ™‚é–“å·®ã®å¯èƒ½æ€§ï¼‰

### API Service ãƒ­ã‚°
- ç‰¹è¨˜ã™ã¹ãã‚¨ãƒ©ãƒ¼ãªã—
- 200 OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ­£å¸¸ã«è¿”ã•ã‚Œã¦ã„ã‚‹

---

## ğŸ¤” æƒ³å®šã•ã‚Œã‚‹åŸå› 

### 1. **Resendå´ã®è¨­å®šä¸å‚™**
- ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼ãŒæœªå®Œäº†
- API Keyã®æ¨©é™ä¸è¶³
- é€ä¿¡åˆ¶é™ã«é”ã—ã¦ã„ã‚‹

### 2. **Supabaseè¨­å®šã®ä¸å‚™**
- From Email Address ã®æ¤œè¨¼ãŒæœªå®Œäº†
- Email Templates ã®è¨­å®šå•é¡Œ
- Rate Limiting ã®å½±éŸ¿

### 3. **ãƒ¡ãƒ¼ãƒ«é…ä¿¡ã‚¤ãƒ³ãƒ•ãƒ©ã®å•é¡Œ**
- SPF/DKIMè¨­å®šã®ä¸å‚™
- ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã®ã‚¹ãƒ‘ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é…ä¿¡é…å»¶

---

## ğŸ› ï¸ ç’°å¢ƒãƒ»è¨­å®šè©³ç´°

### Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
- **Project ID**: `gftbjdazuhjcvqvssyiu`
- **Region**: æœªç¢ºèª
- **Subscription**: ç„¡æ–™ãƒ—ãƒ©ãƒ³

### æ—¢å­˜Edge Functions
- `send-general-contact`: Resendçµ±åˆæ¸ˆã¿
- â€»`send-contact-email` ã¯å‰Šé™¤æ¸ˆã¿

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç’°å¢ƒ
- **Framework**: React + Vite + TypeScript
- **Auth Library**: @supabase/supabase-js
- **Deployment**: Cloudflare Pages

---

## ğŸ¯ è¿½åŠ èª¿æŸ»ãŒå¿…è¦ãªé …ç›®

1. **Resend Dashboardç¢ºèª**
   - ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼çŠ¶æ³
   - API Keyä½¿ç”¨åˆ¶é™
   - é€ä¿¡å±¥æ­´ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°

2. **Supabaseè¨­å®šå†ç¢ºèª**
   - Email Templateså†…å®¹
   - From Email Addressã®æ¤œè¨¼çŠ¶æ³
   - Rate Limitingè¨­å®š

3. **ãƒ¡ãƒ¼ãƒ«é…ä¿¡ãƒ†ã‚¹ãƒˆ**
   - ç•°ãªã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã®ãƒ†ã‚¹ãƒˆ
   - é€ä¿¡è€…ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´ãƒ†ã‚¹ãƒˆ
   - ã‚¹ãƒ‘ãƒ ãƒ•ã‚©ãƒ«ãƒ€ã®ç¢ºèª

4. **ãƒ­ã‚°è©³ç´°ç¢ºèª**
   - Resendå´ã®é€ä¿¡ãƒ­ã‚°
   - ã‚ˆã‚Šè©³ç´°ãªSupabaseãƒ­ã‚°
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¬ãƒ™ãƒ«ã®é…ä¿¡ç¢ºèª

---

## ğŸ’¡ ææ¡ˆã•ã‚Œã‚‹è§£æ±ºç­–

### **çŸ­æœŸå¯¾å¿œ**
1. **Resend Dashboardã§ã®é€ä¿¡å±¥æ­´ç¢ºèª**
2. **ç•°ãªã‚‹é€ä¿¡è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã®ãƒ†ã‚¹ãƒˆ**
3. **Supabase Email Templatesã®ç¢ºèªãƒ»ä¿®æ­£**

### **ä¸­æœŸå¯¾å¿œ**
1. **ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼ã®å®Œå…¨å®Ÿè£…**
2. **SPF/DKIMè¨­å®šã®ç¢ºèªãƒ»ä¿®æ­£**
3. **ä»£æ›¿ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®æ¤œè¨**

### **é•·æœŸå¯¾å¿œ**
1. **ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ ã®ç›£è¦–ä½“åˆ¶æ§‹ç¯‰**
2. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã®å®Ÿè£…**
3. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆãƒ¡ãƒ¼ãƒ«å†é€ä¿¡æ©Ÿèƒ½ç­‰ï¼‰**

---

## ğŸ” ç·Šæ€¥ç¢ºèªäº‹é …

**å³åº§ã«ç¢ºèªã™ã¹ãé …ç›®:**

1. **ğŸ“§ Resend Dashboard**
   - https://resend.com/dashboard
   - æœ€è¿‘ã®é€ä¿¡å±¥æ­´ã« `abe-a@tachibana-u.ac.jp` å®›ã®ãƒ¡ãƒ¼ãƒ«ãŒã‚ã‚‹ã‹ï¼Ÿ

2. **ğŸ” APIã‚­ãƒ¼æ¨©é™**
   - ä½¿ç”¨ä¸­ã®Resend APIã‚­ãƒ¼ã«é€ä¿¡æ¨©é™ãŒã‚ã‚‹ã‹ï¼Ÿ

3. **ğŸŒ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š**
   - `pianosearch.com` ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒResendã§èªè¨¼æ¸ˆã¿ã‹ï¼Ÿ

4. **ğŸ“ Email Templates**
   - Supabase Auth Templates ã«å•é¡Œã¯ãªã„ã‹ï¼Ÿ

**ã“ã®æƒ…å ±ã«ã‚ˆã‚Šã€å•é¡Œã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã—ã€é©åˆ‡ãªè§£æ±ºç­–ã‚’æ±ºå®šã§ãã¾ã™ã€‚** 