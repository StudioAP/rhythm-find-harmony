# 🎯 開発ガイドライン - ABEさんの信念実現

**原則**: 本番品質・妥協なし・型安全性

---

## 🚀 **クイックルール**

### **1. データベースクエリ**
```typescript
✅ DO: const { data } = await supabase.from('table').select('col1, col2')
❌ DON'T: 複雑なリレーションクエリ
```

### **2. 型定義**
```typescript
✅ DO: interface SpecificType { required: string }
❌ DON'T: const data = response as any
```

### **3. ビジネスロジック**
```typescript
✅ DO: 厳格な検証、妥協なし
❌ DON'T: 開発用の緩い条件
```

### **4. エラーハンドリング**
```typescript
✅ DO: 詳細ログ + ユーザーフレンドリーメッセージ
❌ DON'T: エラーの隠蔽
```

---

## 📋 **実装前チェック**

- [ ] any型を避けているか？
- [ ] ビジネスロジックは妥協なしか？
- [ ] エラーハンドリングは適切か？
- [ ] 本番環境を想定しているか？

---

**詳細**: `DATABASE_RELATIONSHIP_FIX.md` 参照 

## 問題解決・デバッグの原則

### 1. 根拠に基づく分析の徹底

#### ❌ 避けるべき行動
- 推測や仮説に基づく断定
- 不十分な検証での原因特定
- 表面的な症状のみでの判断

#### ✅ 推奨される行動
- **実際のログ・データの確認を最優先**
- **段階的な検証プロセスの実行**
- **複数の可能性を排除的に検討**

### 2. 環境変数・設定関連の問題解決

#### 問題発生時の確認手順
1. **実際の設定値の確認**
   ```javascript
   // デバッグログの一時的追加
   console.log('Environment Check:', {
     url: import.meta.env.VITE_SUPABASE_URL,
     key: import.meta.env.VITE_SUPABASE_ANON_KEY?.substring(0, 20) + '...'
   });
   ```

2. **ファイルベース vs プロセス環境変数の区別**
   - Viteは`.env`ファイルを直接読み込む
   - シェル環境変数の状態 ≠ アプリケーションの設定

3. **ネットワークリクエストの実際の送信先確認**
   - ブラウザDevToolsのNetworkタブで検証
   - 期待値と実際値の照合

### 3. 認証関連の問題解決

#### Supabase認証エラーの体系的確認

1. **環境変数の正確性**
2. **アカウントの存在確認**
   ```sql
   SELECT id, email, email_confirmed_at, created_at 
   FROM auth.users 
   WHERE email = 'target@email.com';
   ```

3. **メール認証状態の確認**
   - `email_confirmed_at`が`null`の場合は未認証
   - 開発環境では手動認証を検討

4. **認証情報の正確性**
   - パスワードの大文字小文字
   - 特殊文字の扱い

### 4. デバッグ情報の適切な管理

#### 一時的デバッグログの原則
```javascript
// ✅ 良い例：本番環境を考慮した条件付きログ
if (import.meta.env.DEV) {
  console.log('Debug Info:', debugData);
}

// ❌ 悪い例：本番環境にも残るログ
console.log('Debug Info:', debugData);
```

#### デバッグログの削除管理
- 問題解決後は必ず削除
- Git commitに含めない
- 本番環境への漏洩防止

### 5. データベース直接操作の原則

#### 安全な確認手順
1. **読み取り専用での状況確認**
2. **影響範囲の事前評価**
3. **バックアップの考慮**
4. **段階的な修正実行**

#### 開発環境での迅速対応
```sql
-- ✅ 開発環境：メール認証の手動完了
UPDATE auth.users 
SET email_confirmed_at = NOW() 
WHERE email = 'dev@example.com';
```

### 6. 問題解決のコミュニケーション

#### 報告の原則
- **事実と推測の明確な区別**
- **検証済み事項と未検証事項の分離**
- **段階的な確認プロセスの共有**

#### ❌ 避けるべき表現
- "環境変数が原因です"（未検証）
- "〜のはずです"（推測）
- "おそらく〜でしょう"（根拠不足）

#### ✅ 推奨される表現
- "ログで確認した結果、〜です"
- "データベースを確認したところ、〜でした"
- "以下の手順で検証します"

### 7. 問題の優先順位付け

#### 確認順序の原則
1. **実際のログ・エラーメッセージの確認**
2. **設定値の実際の確認**
3. **データベース状態の確認**
4. **ネットワーク状況の確認**
5. **環境の不整合確認**

### 8. 学習とフィードバック

#### 問題解決後の振り返り
- **誤った仮説の分析**
- **見落としたポイントの整理**
- **効果的だった手順の文書化**
- **次回への改善点の明確化**

---

## 実装品質の原則

### コードレビューチェックリスト
- [ ] デバッグログが本番環境に残っていないか
- [ ] 環境変数の適切な処理
- [ ] エラーハンドリングの充実
- [ ] 段階的なテストの実行

### 本番デプロイ前チェック
- [ ] 全ての一時的デバッグコードの削除
- [ ] 環境変数の本番設定確認
- [ ] 認証フローの完全テスト
- [ ] データベース接続の確認

---

*このガイドラインは実際の問題解決経験に基づいて作成され、継続的に更新されます。* 